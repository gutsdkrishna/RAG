<!DOCTYPE html>
<html>
  <head>
    <title>Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <style>
      body {
        font-family: sans-serif;
        background-color: #f8f9fa;
      }
      .container {
        padding: 20px;
      }
      .card {
        margin-bottom: 20px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .card:hover {
        transform: scale(1.02);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      thead th {
        background-color: #343a40;
        color: #fff;
        text-align: center;
        padding: 10px;
      }
      tbody td {
        text-align: center;
        padding: 10px;
        border-bottom: 1px solid #dee2e6;
      }
      tbody tr:hover {
        background-color: #f1f3f5;
      }
      button {
        margin-top: 5px;
        padding: 5px 10px;
        border: none;
        background-color: #007bff;
        color: #fff;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      .edit-input {
        width: 100%;
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="mb-4">Admin Dashboard</h1>
      <div class="row">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>User ID</th>
              <th>Role</th>
              <th>Content</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for message in messages %}
            <tr id="row-{{ loop.index }}">
              <td>{{ message.user_id }}</td>
              <td>{{ message.role }}</td>
              <td>
                <textarea
                  class="edit-input"
                  id="content-response-{{ loop.index }}"
                >
{{ message.content }}\n{{ message.response }}</textarea
                >
              </td>
              <td>
                <button onclick="saveChanges('{{ loop.index }}')">Save</button>
                <button onclick="deleteRow('{{ loop.index }}')">Delete</button>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <script>
      function saveChanges(index) {
        const contentResponse = document.getElementById(
          `content-response-${index}`
        ).value;
        const [content, response] = contentResponse.split("\n", 2);
        // Add logic to send updated content and response to the server
        console.log(`Saving changes for row ${index}:`, { content, response });
      }

      function deleteRow(index) {
        const row = document.getElementById(`row-${index}`);
        const userId = row.querySelector("td:first-child").innerText;
        const role = row.querySelector("td:nth-child(2)").innerText;

        fetch(`/delete_message`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ user_id: userId, role: role }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              row.remove();
              console.log(`Deleted row ${index} from database`);
            } else {
              console.error(`Failed to delete row ${index}:`, data.error);
            }
          })
          .catch((error) => console.error("Error:", error));
      }
    </script>
  </body>
</html>
